{% load asset_tags %}
{% load fontawesome_tags %}

{% if asset.state == "UPLOADING" %}
    <article class="sketchbox" hx-trigger="every 2000ms" hx-get="{% url 'asset_status' asset_url=asset.url %}" hx-swap="outerHTML" hx-target="this">
{% else %}
    <article class="sketchbox">
{% endif %}
    {% if asset.state != "COMPLETE" %}
        <div class="sketchimage {{ asset.state }}"
            style="background-image: url('/static/images/nothumbnail.png?v=1');">
        </div>
    {% else %}
        <a href="{% if can_edit_asset %}{{ asset.get_edit_url }}{% else %}{{asset.get_absolute_url}}{% endif %}" role="presentation">
            <div class="sketchimage"
                style="background-image: url('{{ asset.get_thumbnail_url }}');">
            </div>
        </a>
    {% endif %}
    <h4>
        {% spaceless %}
        {% if asset.state != "COMPLETE" %}
            {% if can_edit_asset %}
                {% if asset.state == "FAILED" %}
                    <p>{% fa_icon "solid" "triangle-exclamation" %} Asset failed to upload. Please try again or contact support.</p>
                {% endif %}
                {% if asset.state == "UPLOADING" %}
                    <p>{% fa_icon "solid" "arrows-rotate" "fa-spin" %} Upload in progress&hellip;</p>
                {% endif %}
            {% endif %}
            {{ asset.name|default_if_none:"" }}
        {% else %}
            <a href="{% if can_edit_asset %}{{ asset.get_edit_url }}{% else %}{{asset.get_absolute_url}}{% endif %}">
                {{ asset.name|default_if_none:"Untitled asset" }}
            </a>
        {% endif %}
        {% if not can_edit_asset %}
            {% like_button request asset %}
        {% endif %}
        {% endspaceless %}
    </h4>
    <a href="{% url 'user_show' user_url=asset.owner.url %}">{{ asset.owner.displayname }}</a>
    <div class="date">{{ asset.timestamp|date:"Y-m-d" }}</div>
    <p>
        <small>{{ asset.get_license_display|default_if_none:"All rights reserved" }}</small>
    </p>
</article>
{% if asset.state == "COMPLETE" and is_polling %}
    <script>
        let el = document.querySelector("#uploadmessages");
        if (el !== null) {
            el.remove();
        }
    </script>
{% endif %}
