{% extends "base.html" %}
{% load static %}
{% load paginator_tags %}

{% block extrahead %}
    {{ block.super }}
    <link rel="canonical" href="{% clean_url %}">
{% endblock extrahead %}

{% block content %}
<div class="container">
</div>
<div class="container">
    {% if messages %}
    <ul class="messages" id="uploadmessages">
        {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    <div class="row">
        <div class="col">
            <h1>{{ page_title }}</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <h2>Upload Single Asset</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <form action="{% url 'icosa:uploads' %}" class="file-form" method="post" enctype="multipart/form-data" novalidate>
                {% csrf_token %}
                {% if form.file.errors %}
                    {{ form.file.errors }}
                {% endif %}
                <input multiple type="file" class="form-control-file" name="file" required>
                <button type="submit" class="btn btn-primary">Upload</button>
            </form>
        </div>
        <div class="col-lg-6">
                <details>
                    <summary>
                        Note: We support the following formats:
                    </summary>
                    <div class="details-content">
                        <ul>
                            <li>gltf (+bin)</li>
                            <li>glb</li>
                            <li>tilt</li>
                            <li>blocks</li>
                            <li>fbx (+fbm)</li>
                            <li>obj (+mtl)</li>
                            <li>stl</li>
                            <li>usdz</li>
                            <li>vox</li>
                            <li>ply</li>
                            <li>sog</li>
                            <li>spz</li>
                            <li>splat</li>
                            <li>ksplat</li>
                        </ul>
                    </div>
                </details>
            <p>
                Currently you can upload a zip file containing all relevant files.
                <br>
                (For example, if uploading <code>sketch.gltf</code>, make sure <code>sketch.bin</code> is
                also included in the zip file.)
                <br>
                <strong>or</strong> you can upload a glb file.
            </p>
            <p>Include an image file named <code>thumbnail.png</code> in the root of your zip file to use this as your asset's thumbnail for display on this site. If uploading a glb or zip without a thumbnail, you can upload one later by editing your work's settings.</p>
            {% if config.BETA_MODE %}
                <p><strong>This site is currently in Beta mode. While we will do our best to keep things stable, your data may be removed at any time. Please bear this in mind when uploading your work.</strong></p>
            {% endif %}
        </div>
    </div>
    <hr style="margin: 2rem 0;">
    <div class="row">
        <div class="col-lg-6">
            <h2>Upload Collection from Zip</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <form action="{% url 'icosa:uploads' %}" class="file-form" method="post" enctype="multipart/form-data" novalidate>
                {% csrf_token %}
                {% if collection_form.errors %}
                    <div class="alert alert-danger">
                        {{ collection_form.errors }}
                    </div>
                {% endif %}
                <div class="form-group">
                    <label for="existing_collection">Add to Existing Collection (optional)</label>
                    <select class="form-control" id="existing_collection" name="existing_collection">
                        <option value="">-- Create New Collection --</option>
                        {% for collection in collection_form.existing_collection.field.queryset %}
                            <option value="{{ collection.id }}">{{ collection.name }}</option>
                        {% endfor %}
                    </select>
                    <small class="form-text text-muted">Select an existing collection or leave blank to create a new one</small>
                </div>
                <div class="form-group">
                    <label for="collection_name">Collection Name</label>
                    <input type="text" class="form-control" id="collection_name" name="collection_name" placeholder="My Collection">
                    <small class="form-text text-muted">Required if creating a new collection</small>
                </div>
                <div class="form-group">
                    <label for="visibility">Visibility</label>
                    <select class="form-control" id="visibility" name="visibility" required>
                        <option value="PRIVATE" selected>Private</option>
                        <option value="UNLISTED">Unlisted</option>
                        <option value="PUBLIC">Public</option>
                    </select>
                    <small class="form-text text-muted">Visibility for all uploaded assets</small>
                </div>
                <div class="form-group">
                    <label for="license">License</label>
                    <select class="form-control" id="license" name="license">
                        <option value="">No license chosen</option>
                        <option value="CREATIVE_COMMONS_BY_4_0">CC BY Attribution 4.0 International</option>
                        <option value="CREATIVE_COMMONS_0">CC0 1.0 Universal</option>
                        <option value="ALL_RIGHTS_RESERVED">All rights reserved</option>
                    </select>
                    <small class="form-text text-muted">Required for public or unlisted assets</small>
                </div>
                <div class="form-group">
                    <label for="collection_zip">Zip File</label>
                    <input type="file" class="form-control-file" id="collection_zip" name="collection_zip" accept=".zip" required>
                </div>
                <button type="submit" class="btn btn-success">Upload Collection</button>
            </form>
        </div>
        <div class="col-lg-6">
            <p>
                Upload a zip file containing multiple assets to create or add to a collection. The zip file can be structured in two ways:
            </p>
            <details>
                <summary><strong>Option 1: Single files at root level</strong></summary>
                <div class="details-content">
                    <p>Each 3D file at the root becomes a separate asset named after the filename:</p>
                    <pre>
my-collection.zip
├── model1.glb
├── model1.png        ← Optional thumbnail for model1
├── model2.glb
├── model2.jpg        ← Optional thumbnail for model2
└── model3.glb</pre>
                    <p>This will create 3 assets: "model1", "model2", and "model3".</p>
                    <p><strong>Thumbnails:</strong> Include a PNG or JPG with the same name as the 3D file.</p>
                </div>
            </details>
            <details>
                <summary><strong>Option 2: Directories containing asset files</strong></summary>
                <div class="details-content">
                    <p>Each directory becomes an asset named after the directory, containing all files in that directory:</p>
                    <pre>
my-collection.zip
├── asset1/
│   ├── model.gltf
│   ├── model.bin
│   ├── texture.png
│   └── thumbnail.png  ← Optional thumbnail
├── asset2/
│   ├── model.glb
│   └── thumbnail.jpg  ← Optional thumbnail
└── asset3/
    └── model.glb</pre>
                    <p>This will create 3 assets: "asset1", "asset2", and "asset3".</p>
                    <p><strong>Thumbnails:</strong> Include a file named <code>thumbnail.png</code> or <code>thumbnail.jpg</code> in each directory.</p>
                </div>
            </details>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col">
            <h2>Manage Uploads</h2>
        </div>
    </div>
    <div class="sketch-list">
        {% if assets %}
            {% for asset in assets %}
                {% include "partials/sketch_list_item_owner.html" %}
            {% endfor %}
        {% else %}
            <p>You haven't uploaded anything yet.</p>
        {% endif %}
    </div>
    {% if assets %}
        {% include "partials/pagination.html" %}
    {% endif %}
</div>
{% endblock content %}
